name: Create PR and Auto Merge 
  
on:
  workflow_dispatch:

  
jobs:  
  create-pr:  
    runs-on: ubuntu-latest  
    steps:  
      - name: Checkout  
        uses: actions/checkout@v3
  
      - name: Create Pull Request  
        id: create_pr
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |  
          PR_URL=$(gh pr create --base main --head ${{ github.ref_name }} --title "[Automated] Create PR from  ${{ github.ref_name }} into ${{ github.event.repository.default_branch }}" --body "Please review this PR.")
          echo "The PR_URL of new tag is: $PR_URL"
          PR_NUMBER=$(echo "$PR_URL" | sed 's/.*\///')
          echo "The PR_NUMBER of new tag is: $PR_NUMBER"
          eval echo "pr_number=$pr_number >> $GITHUB_OUTPUT"
  
      - name: enable automerge
        if: steps.create_pr.outputs.pr_number != ''
        uses: peter-evans/enable-pull-request-automerge@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          pull-request-number: ${{ steps.create_pr.outputs.pr_number }}
          merge-method: merge
